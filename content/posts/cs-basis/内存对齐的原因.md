---
title: "内存对齐的原因"
date: 2022-10-04T11:38:07+08:00
topics: "cs-basis"
draft: true
---

# 内存对齐的原因

**硬件平台限制**

对于使用者来说，我们的确可以通过汇编（机器指令）访问内存中每一个字节的指令，但硬件底层可能实际仅支持对$2^k$整数倍的地址访问，并且一次性读出多个字节。

比如，对于32位的CPU而言，它的数据线有32根一次性可以传输32b的数据，并且内存访问只能从地址为4的倍数读取。所以当我们访问1B内容时，CPU取回4B内容还需要剔除多余的3B才得到我们想要的值。

所以我们在内存中的数据结构需要内存对齐，避免对1个变量的多次访问（一个4B变量，如果不是从4的倍数地址开始存储，就要访问两次内存）

# CPU为何要设计成这样

1. 可能是出于硬件设计的要求
> 硬件内容不深究

2. 出于提高数据访问效率的要求

由于由多条数据线（比如32位），机器天生就可以一次性读取多个数据。另一方面，对于内存的使用者来说也并不是1个字节1个字节这样使用的，比如常用的`int、double`变量。我们读取`int`型变量，自然希望直接一次内存访问，就可以直接获取4B的内容，不然如果真要1个字节1个字节，对于大字节的变量访问和修改也太花时间了。
> 就算这样，也没必要说一定得设计成只能倍数地址访问吧？？
> 这方面的原因，可能只能归结于硬件上的考虑了
